<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sigma Magnetic Meter</title>

<style>
@keyframes rgb-cycle {
  0% { color:red; border-color:red; }
  33% { color:lime; border-color:lime; }
  66% { color:blue; border-color:blue; }
  100% { color:red; border-color:red; }
}

body {
  margin:0;
  background:#000;
  font-family:Courier New, monospace;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
  color:white;
  overflow:hidden;
}

body.jolly-mode {
  background-image:url("whyishesojolly.jpg");
  background-size:cover;
}

.settings-btn {
  position:fixed;
  top:20px;
  right:20px;
  background:none;
  border:2px solid white;
  color:white;
  padding:10px;
  cursor:pointer;
}

#settings-panel {
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:black;
  border:3px solid white;
  padding:20px;
  border-radius:15px;
  width:80%;
  z-index:999;
}

#gauge {
  width:300px;
  height:150px;
  border:4px solid #555;
  border-radius:150px 150px 0 0;
  position:relative;
  margin:20px 0;
}

#needle {
  position:absolute;
  bottom:0;
  left:50%;
  width:5px;
  height:130px;
  background:red;
  transform-origin:bottom;
  transform:rotate(-90deg);
  box-shadow:0 0 10px red;
}

#char-img {
  width:150px;
  height:150px;
  border-radius:50%;
  border:5px solid white;
  animation:rgb-cycle 3s infinite linear;
}

.active-sigma {
  animation:shake 0.05s infinite;
}
@keyframes shake {
  0%{transform:scale(1.1) translate(2px,2px)}
  50%{transform:scale(1.1) translate(-2px,-2px)}
}

#audio-container {
  width:100%;
  height:120px;
  animation:rgb-cycle 2s infinite linear;
}

canvas {
  width:100%;
  height:100px;
}

</style>
</head>

<body>

<button class="settings-btn" onclick="toggleSettings()">⚙ SETTINGS</button>

<div id="settings-panel">
  <h2 style="color:red">MAGNETIC CALIBRATION</h2>
  <input type="range" id="sensitivity" min="10" max="200" value="50" style="width:100%">
  <hr>

  <h3>AUDIO BOOST (RGB)</h3>
  <div id="audio-container">
    <canvas id="audioCanvas"></canvas>
  </div>
  <p id="volText" style="text-align:center">Volume: 1.00x</p>

  <hr>
  <h3>JOLLY MODE</h3>
  <input type="checkbox" id="jollyToggle" onchange="applyJollyMode()" style="transform:scale(2)">
  <br><br>
  <button onclick="toggleSettings()" style="width:100%;padding:10px">SAVE</button>
</div>

<div id="mag-value">0 μT</div>

<div id="gauge">
  <div id="needle"></div>
</div>

<img id="char-img" src="lebron.png">

<button onclick="initSensor()" style="padding:15px;margin-top:15px">ENABLE SENSOR</button>

<audio id="lebronScream" src="lebronscream.mp3"></audio>
<audio id="jonklerScream" src="why-so-jolly-made-with-Voicemod.mp3"></audio>

<script>
let audioCtx, gainNode;
let sliderValue = 100;

function toggleSettings(){
  const p=document.getElementById("settings-panel");
  p.style.display=p.style.display==="block"?"none":"block";
}

function applyJollyMode(){
  if(jollyToggle.checked){
    document.body.classList.add("jolly-mode");
    charImg.src="whysojolly.jpg";
  } else {
    document.body.classList.remove("jolly-mode");
    charImg.src="lebron.png";
  }
}

async function initSensor(){
  if(!audioCtx){
    audioCtx=new AudioContext();
    gainNode=audioCtx.createGain();
    gainNode.connect(audioCtx.destination);
    const s1=audioCtx.createMediaElementSource(lebronScream);
    const s2=audioCtx.createMediaElementSource(jonklerScream);
    s1.connect(gainNode);
    s2.connect(gainNode);
  }
  simulateSensor();
}

function simulateSensor(){
  setInterval(()=>{
    let v=Math.random()*80;
    magValue.innerText=Math.floor(v)+" μT";
    let limit=sensitivity.value;
    let angle=((v/limit)*180)-90;
    angle=Math.max(-90,Math.min(90,angle));
    needle.style.transform=`rotate(${angle}deg)`;
    if(v>limit){
      gainNode.gain.value=sliderValue/100;
      lebronScream.currentTime=0;
      lebronScream.play();
      charImg.classList.add("active-sigma");
    } else {
      charImg.classList.remove("active-sigma");
    }
  },120);
}

/* RGB JELLY SLIDER (simple canvas version) */
const canvas=document.getElementById("audioCanvas");
const ctx=canvas.getContext("2d");

canvas.width=600;
canvas.height=100;

canvas.addEventListener("mousemove",e=>{
  if(e.buttons){
    sliderValue=Math.max(0,Math.min(1000,(e.offsetX/canvas.width)*1000));
    volText.innerText="Volume: "+(sliderValue/100).toFixed(2)+"x";
  }
});

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  let t=Date.now()/500;
  let r=128+127*Math.sin(t);
  let g=128+127*Math.sin(t+2);
  let b=128+127*Math.sin(t+4);
  ctx.strokeStyle=`rgb(${r},${g},${b})`;
  ctx.lineWidth=8;
  ctx.beginPath();
  ctx.moveTo(0,50);
  ctx.lineTo((sliderValue/1000)*canvas.width,50);
  ctx.stroke();
  requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
